import{_ as X,p as R,r as s,x as J,q as h,o as g,c as N,a as r,f as a,w as m,e as B,H as ee,g as A,t as q,y as te,D as oe,I as Q,F as Z,k as G,J as ne,n as W,h as le}from"./index-DTGUHq3f.js";const de={__name:"CodeMng",props:{data:{type:Array,required:!0},saveUrl:{type:String,default:"code"},showNodeKey:{type:Boolean,default:!1},nodeKey:{type:String,default:"id"},uprNodeKey:{type:String,default:"uprId"},treeProps:{type:Object,default:{label:"label",value:"value"}},codeType:{type:String,default:"CD"},draggable:{type:Boolean,default:!1},filter:{type:Boolean,default:!1}},emits:["keyupEnter","nodeSelect"],setup(D,{expose:o,emit:b}){const t=R("axios"),E=R("msg"),C=b,n=D,f={CODE:"코드",CATEGORY:"카테고리"},d=s(null),k=s(null),v=s(null),P=s(),y=s(n.data),S=s("");J(S,e=>{v.value.filter(e)});const _=e=>{j(e[n.nodeKey])},w=e=>{d.value=e[n.nodeKey],T(e)?k.value=f.CATEGORY:k.value=f.CODE,P.value.open()},L=(e,l)=>{T(e)&&(l.expanded=!l.expanded),C("nodeSelect",e)},z=e=>{const l=e.target.dataset.key;switch(e.key){case"ArrowUp":case"ArrowDown":C("nodeSelect",M(l));return;case"+":case"Insert":j(l);return;case"-":case"Delete":case"Backspace":F(l);return;case"Enter":C("keyupEnter",M(l));return}},V=(e,l,u,i)=>{const p=e.data,c=U(p[n.nodeKey]);c?p[n.uprNodeKey]=c[n.nodeKey]:p[n.uprNodeKey]=null,I()},x=()=>{t.post(n.saveUrl,n.data[0]).then(()=>{E({message:"저장되었습니다",type:"success"})})},O=(e,l,u)=>{if(!e)return!0;const i=n.treeProps.label;return l[i].includes(e)},K=e=>{let l=null,u=null;const i=p=>{for(const c of p){if(console.debug("노드 순회중... : ",c),T(c)&&c.children.find(Y=>Y[n.nodeKey]==e)&&(u=c,console.debug("부모 노드 발견 : ",c)),c[n.nodeKey]==e){l=c,console.debug("대상 노드 발견 : ",c);return}T(c)&&i(c.children)}};return i(y.value),{node:l,parentNode:u}},M=e=>{const{node:l}=K(e);return l},U=e=>{const{parentNode:l}=K(e);return l},j=e=>{const{node:l,parentNode:u}=K(e);l.children.push({[n.nodeKey]:null,[n.treeProps.label]:"생성된 노드",children:[],[n.uprNodeKey]:e}),I(),y.value=[...y.value]},F=e=>{alert(e);const{node:l,parentNode:u}=K(e);if(T(u)){const i=u.children.findIndex(p=>p[n.nodeKey]==e);u.children.splice(i,1),y.value=[...y.value]}I()},T=e=>e.children&&e.children.length>0,I=()=>{const e={type:n.codeType,category:0,no:1},l=i=>i[n.uprNodeKey]==e.type+"00000001",u=i=>{for(const p of i){l(p)&&(e.category++,e.no=1);const c=e.type+String(e.category).padStart(4,"0")+String(e.no++).padStart(4,"0");p[n.nodeKey]=c,T(p)&&(p.children.forEach(Y=>Y[n.uprNodeKey]=c),u(p.children))}};u(y.value)},$=e=>{l(v.value.root.childNodes);function l(u){for(const i of u)e?i.expand():i.collapse(),i.childNodes&&l(i.childNodes)}};o({initNodeKeys:I,addNodeByKey:j,removeNodeByKey:F,getNodeByKey:M,getParentNodeByKey:U,getNodeAndParentNodeByKey:K});const H={axios:t,msg:E,emits:C,props:n,DEL_TYPE:f,delTargetNodeKey:d,delTypeNm:k,treeRef:v,delConfirmRef:P,nodeList:y,filterText:S,handleAppendClick:_,handleRemoveClick:w,hanldeNodeClick:L,handleKeyEvt:z,handleDropEvt:V,handleSaveClick:x,filterNode:O,getNodeAndParentNodeByKey:K,getNodeByKey:M,getParentNodeByKey:U,addNodeByKey:j,removeNodeByKey:F,hasChildrenCheck:T,initNodeKeys:I,setNodeExpandAll:$,inject:R,onMounted:G,ref:s,watch:J,watchEffect:ne};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}},se={class:"space-y-2"},re={class:"text-right"},ae={key:0},ie={class:"flex items-center justify-between w-full pr-1"},ce={key:0},ue={key:0},pe={key:1};function fe(D,o,b,t,E,C){const n=h("RemoveFilled"),f=h("el-icon"),d=h("el-button"),k=h("CirclePlusFilled"),v=h("el-input"),P=h("Check"),y=h("el-tree"),S=h("CmmDialog");return g(),N(Z,null,[r("div",se,[r("div",re,[r("div",null,[a(d,{link:"",onClick:o[0]||(o[0]=_=>t.setNodeExpandAll(!1))},{default:m(()=>[a(f,null,{default:m(()=>[a(n)]),_:1}),o[6]||(o[6]=B("  ")),o[7]||(o[7]=r("p",null,"모두 접기",-1))]),_:1}),a(d,{link:"",onClick:o[1]||(o[1]=_=>t.setNodeExpandAll(!0))},{default:m(()=>[a(f,null,{default:m(()=>[a(k)]),_:1}),o[8]||(o[8]=B("  ")),o[9]||(o[9]=r("p",null,"모두 확장",-1))]),_:1})])]),t.props.filter?(g(),N("div",ae,[a(v,{modelValue:t.filterText,"onUpdate:modelValue":o[2]||(o[2]=_=>t.filterText=_),placeholder:"코드명으로 검색",onKeyup:o[3]||(o[3]=ee(_=>t.treeRef.filter(t.filterText),["enter"])),clearable:""},null,8,["modelValue"])])):A("v-if",!0),a(d,{size:"large",class:"w-full",type:"primary",onClick:t.handleSaveClick},{default:m(()=>[a(f,null,{default:m(()=>[a(P)]),_:1}),o[10]||(o[10]=B("  저장하기 "))]),_:1}),r("div",null,[a(y,{props:t.props.treeProps,"node-key":t.props.nodeKey,data:t.nodeList,ref:"treeRef",draggable:t.props.draggable,"filter-node-method":t.filterNode,"expand-on-click-node":!1,"default-expand-all":"",onNodeClick:t.hanldeNodeClick,onKeyup:t.handleKeyEvt,onNodeDrop:t.handleDropEvt},{default:m(({node:_,data:w})=>[r("span",ie,[r("span",null,[B(q(_.label)+" ",1),t.props.showNodeKey?(g(),N("span",ce,"("+q(w[t.props.nodeKey])+")",1)):A("v-if",!0)]),r("span",{class:"space-x-4",onClick:o[4]||(o[4]=te(()=>{},["stop"]))},[w[t.props.uprNodeKey]?(g(),oe(d,{key:0,link:"",class:"!p-0",onClick:L=>t.handleRemoveClick(w)},{default:m(()=>[Q(D.$slots,"removeBtn",{},()=>[o[11]||(o[11]=B(" 삭제 "))],!0)]),_:2},1032,["onClick"])):A("v-if",!0),a(d,{link:"",class:"!p-0",onClick:L=>t.handleAppendClick(w)},{default:m(()=>[Q(D.$slots,"addBtn",{},()=>[o[12]||(o[12]=B(" 추가 "))],!0)]),_:2},1032,["onClick"])])])]),_:3},8,["props","node-key","data","draggable"])])]),a(S,{title:`${t.delTypeNm} 삭제`,ref:"delConfirmRef",confirm:"",onConfirm:o[5]||(o[5]=_=>t.removeNodeByKey(t.delTargetNodeKey))},{default:m(()=>[t.delTypeNm==t.DEL_TYPE.CODE?(g(),N("p",ue," 선택된 코드를 정말 삭제하시겠습니까? ")):t.delTypeNm==t.DEL_TYPE.CATEGORY?(g(),N("p",pe," 선택된 카테고리 및 하위 코드까지 함께 삭제됩니다. 정말 삭제하시겠습니까? ")):A("v-if",!0)]),_:1},8,["title"])],64)}const ye=X(de,[["render",fe],["__scopeId","data-v-7e1c46f1"],["__file","C:/Users/mw/pjts/frontend/editor/src/components/mng/CodeMng.vue"]]),me={__name:"CodeMngPage",setup(D,{expose:o}){o();const b=R("axios"),t=R("config"),E=R("msg"),C=s(null),n=s(null),f=s(null),d=s([]),k=s([]),v=s(!0),P=s("first"),y=s(""),S=s([]),_=s(null);G(()=>{b.get("code").then(x=>{d.value.push(x.data[0]||{cdId:null,cdNm:"초기값"}),C.value.initNodeKeys()}).finally(()=>{v.value=!1})});const V={axios:b,config:t,msg:E,treeRef:C,formRef:n,searchResultRef:f,nodeList:d,selectedNode:k,isLoading:v,activeName:P,searchCdId:y,resultCds:S,selectCd:_,handleNodeSelect:x=>k.value=x,handleEnterkey:()=>{const O=Array.from(n.value.querySelectorAll("input")).find(K=>!K.disabled);O&&O.focus()},searchChildCd:()=>{b.get("code/upr/"+y.value).then(x=>{S.value=x.data,E({message:"입력된 코드의 모든 하위 코드를 불러왔습니다",type:"success"}),W(()=>f.value.focus())})},inject:R,nextTick:W,onMounted:G,ref:s,CodeMng:ye};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}},_e={class:"section-area"},ge={class:"article-area",style:{height:"100%"}},ve={style:{display:"flex","column-gap":"1rem",width:"100%",height:"100%"}},he={class:"",style:{height:"100%"}},Ne={style:{width:"100%"}},Ce={key:0,ref:"formRef"},ke={key:0};function xe(D,o,b,t,E,C){const n=h("el-card"),f=h("el-input");return g(),N("section",_e,[o[1]||(o[1]=r("article",{class:"article-area"},[r("p",{class:"section-title"}," 코드 관리 "),r("div",{style:{height:"5px",background:"black",width:"50px",margin:".5em auto 2.5rem auto"}})],-1)),r("article",ge,[r("div",ve,[r("div",he,[a(n,{style:{width:"400px",height:"100%"}},{default:m(()=>[a(t.CodeMng,{data:t.nodeList,"save-url":"/code",filter:"","show-node-key":"","node-key":"cdId","upr-node-key":"uprCdId","code-type":"CD","tree-props":{label:"cdNm",value:"cdId"},draggable:"",onNodeSelect:t.handleNodeSelect,onKeyupEnter:t.handleEnterkey,ref:"treeRef"},null,8,["data"])]),_:1})]),r("div",Ne,[a(n,{class:"h-full"},{default:m(()=>[t.isLoading?A("v-if",!0):(g(),N("div",Ce,[o[0]||(o[0]=r("p",{class:"text-xl"},"코드 상세보기",-1)),(g(!0),N(Z,null,le(Object.keys(t.nodeList[0]),(d,k)=>(g(),N("div",{key:d},[d!="children"?(g(),N("div",ke,[r("p",null,q(d),1),a(f,{modelValue:t.selectedNode[d],"onUpdate:modelValue":v=>t.selectedNode[d]=v,disabled:["cdId","uprCdId"].includes(d)},null,8,["modelValue","onUpdate:modelValue","disabled"])])):A("v-if",!0)]))),128))],512))]),_:1})])])])])}const be=X(me,[["render",xe],["__file","C:/Users/mw/pjts/frontend/editor/src/pages/mng/CodeMngPage.vue"]]);export{be as default};
