import{_ as Z,q as A,r as f,z as ee,s as c,o as y,c as k,a as i,i as r,x as a,h as m,L as te,d as x,t as $,A as oe,B as ne,M as R,F as le}from"./index-Ci8QPfqx.js";import{c as se}from"./confirm-D91zX-OQ.js";const de={class:"space-y-2"},re={class:"text-right"},ae={key:0},ie={class:"flex items-center justify-between w-full pr-1"},ce={key:0},ue={key:0},pe={key:1},fe={__name:"CodeMng",props:{data:{type:Array,required:!0},saveUrl:{type:String,default:"code"},showNodeKey:{type:Boolean,default:!1},nodeKey:{type:String,default:"id"},uprNodeKey:{type:String,default:"uprId"},treeProps:{type:Object,default:{label:"label",value:"value"}},codeType:{type:String,default:"CD"},draggable:{type:Boolean,default:!1},filter:{type:Boolean,default:!1}},emits:["keyupEnter","nodeSelect"],setup(F,{expose:V,emit:M}){const O=A("axios"),I=A("msg"),B=M,o=F,D={CODE:"코드",CATEGORY:"카테고리"},U=f(null),E=f(null),C=f(null),j=f(),u=f(o.data),K=f("");ee(K,t=>{C.value.filter(t)});const L=t=>{w(t[o.nodeKey])},Y=(t,e)=>{v(t)&&(e.expanded=!e.expanded),B("nodeSelect",t)},q=t=>{const e=t.target.dataset.key;switch(t.key){case"ArrowUp":case"ArrowDown":B("nodeSelect",S(e));return;case"+":case"Insert":w(e);return;case"-":case"Delete":case"Backspace":_(e);return;case"Enter":B("keyupEnter",S(e));return}},z=(t,e,d,n)=>{const l=t.data,s=P(l[o.nodeKey]);s?l[o.uprNodeKey]=s[o.nodeKey]:l[o.uprNodeKey]=null,h()},G=()=>{se("변경사항을 저장하시겠습니까?","저장").then(()=>{O.post(o.saveUrl,o.data[0]).then(()=>{I({message:"저장되었습니다",type:"success"})})})},H=(t,e,d)=>{if(!t)return!0;const n=o.treeProps.label;return e[n].includes(t)},g=t=>{let e=null,d=null;const n=l=>{for(const s of l){if(console.debug("노드 순회중... : ",s),v(s)&&s.children.find(N=>N[o.nodeKey]==t)&&(d=s,console.debug("부모 노드 발견 : ",s)),s[o.nodeKey]==t){e=s,console.debug("대상 노드 발견 : ",s);return}v(s)&&n(s.children)}};return n(u.value),{node:e,parentNode:d}},S=t=>{const{node:e}=g(t);return e},P=t=>{const{parentNode:e}=g(t);return e},w=t=>{const{node:e,parentNode:d}=g(t);e.children.push({[o.nodeKey]:null,[o.treeProps.label]:"생성된 노드",children:[],[o.uprNodeKey]:t}),h(),u.value=[...u.value]},_=t=>{const{node:e,parentNode:d}=g(t);if(v(d)){const n=d.children.findIndex(l=>l[o.nodeKey]==t);d.children.splice(n,1),u.value=[...u.value]}h()},v=t=>t.children&&t.children.length>0,h=()=>{const t={type:o.codeType,category:0,no:1},e=n=>n[o.uprNodeKey]==t.type+"00000001",d=n=>{for(const l of n){e(l)&&(t.category++,t.no=1);const s=t.type+String(t.category).padStart(4,"0")+String(t.no++).padStart(4,"0");l[o.nodeKey]=s,v(l)&&(l.children.forEach(N=>N[o.uprNodeKey]=s),d(l.children))}};d(u.value)},T=t=>{e(C.value.root.childNodes);function e(d){for(const n of d)t?n.expand():n.collapse(),n.childNodes&&e(n.childNodes)}};return V({initNodeKeys:h,addNodeByKey:w,removeNodeByKey:_,getNodeByKey:S,getParentNodeByKey:P,getNodeAndParentNodeByKey:g}),(t,e)=>{const d=c("RemoveFilled"),n=c("el-icon"),l=c("el-button"),s=c("CirclePlusFilled"),N=c("el-input"),J=c("Check"),Q=c("el-tree"),W=c("CmmDialog");return y(),k(le,null,[i("div",de,[i("div",re,[i("div",null,[r(l,{link:"",onClick:e[0]||(e[0]=p=>T(!1))},{default:a(()=>[r(n,null,{default:a(()=>[r(d)]),_:1}),e[6]||(e[6]=m("  ")),e[7]||(e[7]=i("p",null,"모두 접기",-1))]),_:1}),r(l,{link:"",onClick:e[1]||(e[1]=p=>T(!0))},{default:a(()=>[r(n,null,{default:a(()=>[r(s)]),_:1}),e[8]||(e[8]=m("  ")),e[9]||(e[9]=i("p",null,"모두 확장",-1))]),_:1})])]),o.filter?(y(),k("div",ae,[r(N,{modelValue:K.value,"onUpdate:modelValue":e[2]||(e[2]=p=>K.value=p),placeholder:"코드명으로 검색",onKeyup:e[3]||(e[3]=te(p=>C.value.filter(K.value),["enter"])),clearable:""},null,8,["modelValue"])])):x("",!0),r(l,{size:"large",class:"w-full",type:"primary",onClick:G},{default:a(()=>[r(n,null,{default:a(()=>[r(J)]),_:1}),e[10]||(e[10]=m("  저장하기 "))]),_:1}),i("div",null,[r(Q,{props:o.treeProps,"node-key":o.nodeKey,data:u.value,ref_key:"treeRef",ref:C,draggable:o.draggable,"filter-node-method":H,"expand-on-click-node":!1,"default-expand-all":"",onNodeClick:Y,onKeyup:q,onNodeDrop:z},{default:a(({node:p,data:b})=>[i("span",ie,[i("span",null,[m($(p.label)+" ",1),o.showNodeKey?(y(),k("span",ce,"("+$(b[o.nodeKey])+")",1)):x("",!0)]),i("span",{class:"space-x-4",onClick:e[4]||(e[4]=oe(()=>{},["stop"]))},[b[o.uprNodeKey]?(y(),ne(l,{key:0,link:"",class:"!p-0",onClick:X=>_(b[o.nodeKey])},{default:a(()=>[R(t.$slots,"removeBtn",{},()=>[e[11]||(e[11]=m(" 삭제 "))],!0)]),_:2},1032,["onClick"])):x("",!0),r(l,{link:"",class:"!p-0",onClick:X=>L(b)},{default:a(()=>[R(t.$slots,"addBtn",{},()=>[e[12]||(e[12]=m(" 추가 "))],!0)]),_:2},1032,["onClick"])])])]),_:3},8,["props","node-key","data","draggable"])])]),r(W,{title:`${E.value} 삭제`,ref_key:"delConfirmRef",ref:j,confirm:"",onConfirm:e[5]||(e[5]=p=>_(U.value))},{default:a(()=>[E.value==D.CODE?(y(),k("p",ue," 선택된 코드를 정말 삭제하시겠습니까? ")):E.value==D.CATEGORY?(y(),k("p",pe," 선택된 카테고리 및 하위 코드까지 함께 삭제됩니다. 정말 삭제하시겠습니까? ")):x("",!0)]),_:1},8,["title"])],64)}}},ge=Z(fe,[["__scopeId","data-v-0bb498f6"]]);export{ge as C};
