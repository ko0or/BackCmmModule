import{_ as Z,i as $,r as f,B as ee,e as c,o as y,c as k,a as i,f as r,w as a,k as m,D as te,j as b,t as A,C as oe,h as ne,U as R,F as le}from"./index-COchMYI4.js";import{e as se}from"./confirm-DZkFm3l2.js";const de={class:"space-y-2"},re={class:"text-right"},ae={key:0},ie={class:"flex items-center justify-between w-full pr-1"},ce={key:0},ue={key:0},pe={key:1},fe={__name:"CodeMng",props:{data:{type:Array,required:!0},saveUrl:{type:String,default:"code"},showNodeKey:{type:Boolean,default:!1},nodeKey:{type:String,default:"id"},uprNodeKey:{type:String,default:"uprId"},treeProps:{type:Object,default:{label:"label",value:"value"}},codeType:{type:String,default:"CD"},draggable:{type:Boolean,default:!1},filter:{type:Boolean,default:!1}},emits:["keyupEnter","nodeSelect"],setup(F,{expose:V,emit:O}){const U=$("axios"),j=$("msg"),B=O,o=F,D={CODE:"코드",CATEGORY:"카테고리"},I=f(null),w=f(null),C=f(null),M=f(),u=f(o.data),K=f("");ee(K,t=>{C.value.filter(t)});const Y=t=>{S(t[o.nodeKey])},G=(t,e)=>{N(t)&&(e.expanded=!e.expanded),B("nodeSelect",t)},L=t=>{const e=t.target.dataset.key;switch(t.key){case"ArrowUp":case"ArrowDown":B("nodeSelect",E(e));return;case"+":case"Insert":S(e);return;case"-":case"Delete":case"Backspace":_(e);return;case"Enter":B("keyupEnter",E(e));return}},q=(t,e,s,n)=>{const l=t.data,d=P(l[o.nodeKey]);d?l[o.uprNodeKey]=d[o.nodeKey]:l[o.uprNodeKey]=null,h()},z=()=>{se("변경사항을 저장하시겠습니까?","저장").then(()=>{U.post(o.saveUrl,o.data[0]).then(()=>{j({message:"저장되었습니다",type:"success"})})})},H=(t,e,s)=>{if(!t)return!0;const n=o.treeProps.label;return e[n].includes(t)},v=t=>{let e=null,s=null;const n=l=>{for(const d of l){if(N(d)&&d.children.find(g=>g[o.nodeKey]==t)&&(s=d),d[o.nodeKey]==t){e=d;return}N(d)&&n(d.children)}};return n(u.value),{node:e,parentNode:s}},E=t=>{const{node:e}=v(t);return e},P=t=>{const{parentNode:e}=v(t);return e},S=t=>{const{node:e,parentNode:s}=v(t);e.children.push({[o.nodeKey]:null,[o.treeProps.label]:"생성된 노드",children:[],[o.uprNodeKey]:t}),h(),u.value=[...u.value]},_=t=>{const{node:e,parentNode:s}=v(t);if(N(s)){const n=s.children.findIndex(l=>l[o.nodeKey]==t);s.children.splice(n,1),u.value=[...u.value]}h()},N=t=>t.children&&t.children.length>0,h=()=>{const t={type:o.codeType,category:0,no:1},e=n=>n[o.uprNodeKey]==t.type+"00000001",s=n=>{for(const l of n){e(l)&&(t.category++,t.no=1);const d=t.type+String(t.category).padStart(4,"0")+String(t.no++).padStart(4,"0");l[o.nodeKey]=d,N(l)&&(l.children.forEach(g=>g[o.uprNodeKey]=d),s(l.children))}};s(u.value)},T=t=>{e(C.value.root.childNodes);function e(s){for(const n of s)t?n.expand():n.collapse(),n.childNodes&&e(n.childNodes)}};return V({initNodeKeys:h,addNodeByKey:S,removeNodeByKey:_,getNodeByKey:E,getParentNodeByKey:P,getNodeAndParentNodeByKey:v}),(t,e)=>{const s=c("RemoveFilled"),n=c("el-icon"),l=c("el-button"),d=c("CirclePlusFilled"),g=c("el-input"),J=c("Check"),Q=c("el-tree"),W=c("CmmDialog");return y(),k(le,null,[i("div",de,[i("div",re,[i("div",null,[r(l,{link:"",onClick:e[0]||(e[0]=p=>T(!1))},{default:a(()=>[r(n,null,{default:a(()=>[r(s)]),_:1}),e[6]||(e[6]=m("  ")),e[7]||(e[7]=i("p",null,"모두 접기",-1))]),_:1}),r(l,{link:"",onClick:e[1]||(e[1]=p=>T(!0))},{default:a(()=>[r(n,null,{default:a(()=>[r(d)]),_:1}),e[8]||(e[8]=m("  ")),e[9]||(e[9]=i("p",null,"모두 확장",-1))]),_:1})])]),o.filter?(y(),k("div",ae,[r(g,{modelValue:K.value,"onUpdate:modelValue":e[2]||(e[2]=p=>K.value=p),placeholder:"코드명으로 검색",onKeyup:e[3]||(e[3]=te(p=>C.value.filter(K.value),["enter"])),clearable:""},null,8,["modelValue"])])):b("",!0),r(l,{size:"large",class:"w-full",type:"primary",onClick:z},{default:a(()=>[r(n,null,{default:a(()=>[r(J)]),_:1}),e[10]||(e[10]=m("  저장하기 "))]),_:1}),i("div",null,[r(Q,{props:o.treeProps,"node-key":o.nodeKey,data:u.value,ref_key:"treeRef",ref:C,draggable:o.draggable,"filter-node-method":H,"expand-on-click-node":!1,"default-expand-all":"",onNodeClick:G,onKeyup:L,onNodeDrop:q},{default:a(({node:p,data:x})=>[i("span",ie,[i("span",null,[m(A(p.label)+" ",1),o.showNodeKey?(y(),k("span",ce,"("+A(x[o.nodeKey])+")",1)):b("",!0)]),i("span",{class:"space-x-4",onClick:e[4]||(e[4]=oe(()=>{},["stop"]))},[x[o.uprNodeKey]?(y(),ne(l,{key:0,link:"",class:"!p-0",onClick:X=>_(x[o.nodeKey])},{default:a(()=>[R(t.$slots,"removeBtn",{},()=>[e[11]||(e[11]=m(" 삭제 "))],!0)]),_:2},1032,["onClick"])):b("",!0),r(l,{link:"",class:"!p-0",onClick:X=>Y(x)},{default:a(()=>[R(t.$slots,"addBtn",{},()=>[e[12]||(e[12]=m(" 추가 "))],!0)]),_:2},1032,["onClick"])])])]),_:3},8,["props","node-key","data","draggable"])])]),r(W,{title:`${w.value} 삭제`,ref_key:"delConfirmRef",ref:M,confirm:"",onConfirm:e[5]||(e[5]=p=>_(I.value))},{default:a(()=>[w.value==D.CODE?(y(),k("p",ue," 선택된 코드를 정말 삭제하시겠습니까? ")):w.value==D.CATEGORY?(y(),k("p",pe," 선택된 카테고리 및 하위 코드까지 함께 삭제됩니다. 정말 삭제하시겠습니까? ")):b("",!0)]),_:1},8,["title"])],64)}}},ve=Z(fe,[["__scopeId","data-v-b2debd8d"]]);export{ve as C};
