import{_ as te,q as S,r as i,z as oe,s as v,o as y,c as m,a as d,i as a,x as u,h as K,E as ne,d as b,t as F,A as le,C as se,G,F as Y,b as de,j as ae}from"./index-DZbwfADI.js";const re={class:"space-y-2"},ie={class:"text-right"},ce={key:0},ue={class:"flex items-center justify-between w-full pr-1"},pe={key:0},fe={key:0},ye={key:1},ve={__name:"CodeMng",props:{data:{type:Array,required:!0},saveUrl:{type:String,default:"code"},showNodeKey:{type:Boolean,default:!1},nodeKey:{type:String,default:"id"},uprNodeKey:{type:String,default:"uprId"},treeProps:{type:Object,default:{label:"label",value:"value"}},codeType:{type:String,default:"CD"},draggable:{type:Boolean,default:!1},filter:{type:Boolean,default:!1}},emits:["keyupEnter","nodeSelect"],setup(U,{expose:T,emit:$}){const B=S("axios"),x=S("msg"),_=$,o=U,N={CODE:"코드",CATEGORY:"카테고리"},R=i(null),p=i(null),c=i(null),h=i(),g=i(o.data),f=i("");oe(f,t=>{c.value.filter(t)});const j=t=>{I(t[o.nodeKey])},P=t=>{R.value=t[o.nodeKey],C(t)?p.value=N.CATEGORY:p.value=N.CODE,h.value.open()},q=(t,e)=>{C(t)&&(e.expanded=!e.expanded),_("nodeSelect",t)},z=t=>{const e=t.target.dataset.key;switch(t.key){case"ArrowUp":case"ArrowDown":_("nodeSelect",V(e));return;case"+":case"Insert":I(e);return;case"-":case"Delete":case"Backspace":O(e);return;case"Enter":_("keyupEnter",V(e));return}},H=(t,e,r,n)=>{const l=t.data,s=L(l[o.nodeKey]);s?l[o.uprNodeKey]=s[o.nodeKey]:l[o.uprNodeKey]=null,D()},J=()=>{B.post(o.saveUrl,o.data[0]).then(()=>{x({message:"저장되었습니다",type:"success"})})},Q=(t,e,r)=>{if(!t)return!0;const n=o.treeProps.label;return e[n].includes(t)},E=t=>{let e=null,r=null;const n=l=>{for(const s of l){if(console.debug("노드 순회중... : ",s),C(s)&&s.children.find(w=>w[o.nodeKey]==t)&&(r=s,console.debug("부모 노드 발견 : ",s)),s[o.nodeKey]==t){e=s,console.debug("대상 노드 발견 : ",s);return}C(s)&&n(s.children)}};return n(g.value),{node:e,parentNode:r}},V=t=>{const{node:e}=E(t);return e},L=t=>{const{parentNode:e}=E(t);return e},I=t=>{const{node:e,parentNode:r}=E(t);e.children.push({[o.nodeKey]:null,[o.treeProps.label]:"생성된 노드",children:[],[o.uprNodeKey]:t}),D(),g.value=[...g.value]},O=t=>{alert(t);const{node:e,parentNode:r}=E(t);if(C(r)){const n=r.children.findIndex(l=>l[o.nodeKey]==t);r.children.splice(n,1),g.value=[...g.value]}D()},C=t=>t.children&&t.children.length>0,D=()=>{const t={type:o.codeType,category:0,no:1},e=n=>n[o.uprNodeKey]==t.type+"00000001",r=n=>{for(const l of n){e(l)&&(t.category++,t.no=1);const s=t.type+String(t.category).padStart(4,"0")+String(t.no++).padStart(4,"0");l[o.nodeKey]=s,C(l)&&(l.children.forEach(w=>w[o.uprNodeKey]=s),r(l.children))}};r(g.value)},M=t=>{e(c.value.root.childNodes);function e(r){for(const n of r)t?n.expand():n.collapse(),n.childNodes&&e(n.childNodes)}};return T({initNodeKeys:D,addNodeByKey:I,removeNodeByKey:O,getNodeByKey:V,getParentNodeByKey:L,getNodeAndParentNodeByKey:E}),(t,e)=>{const r=v("RemoveFilled"),n=v("el-icon"),l=v("el-button"),s=v("CirclePlusFilled"),w=v("el-input"),W=v("Check"),X=v("el-tree"),Z=v("CmmDialog");return y(),m(Y,null,[d("div",re,[d("div",ie,[d("div",null,[a(l,{link:"",onClick:e[0]||(e[0]=k=>M(!1))},{default:u(()=>[a(n,null,{default:u(()=>[a(r)]),_:1}),e[6]||(e[6]=K("  ")),e[7]||(e[7]=d("p",null,"모두 접기",-1))]),_:1}),a(l,{link:"",onClick:e[1]||(e[1]=k=>M(!0))},{default:u(()=>[a(n,null,{default:u(()=>[a(s)]),_:1}),e[8]||(e[8]=K("  ")),e[9]||(e[9]=d("p",null,"모두 확장",-1))]),_:1})])]),o.filter?(y(),m("div",ce,[a(w,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=k=>f.value=k),placeholder:"코드명으로 검색",onKeyup:e[3]||(e[3]=ne(k=>c.value.filter(f.value),["enter"])),clearable:""},null,8,["modelValue"])])):b("",!0),a(l,{size:"large",class:"w-full",type:"primary",onClick:J},{default:u(()=>[a(n,null,{default:u(()=>[a(W)]),_:1}),e[10]||(e[10]=K("  저장하기 "))]),_:1}),d("div",null,[a(X,{props:o.treeProps,"node-key":o.nodeKey,data:g.value,ref_key:"treeRef",ref:c,draggable:o.draggable,"filter-node-method":Q,"expand-on-click-node":!1,"default-expand-all":"",onNodeClick:q,onKeyup:z,onNodeDrop:H},{default:u(({node:k,data:A})=>[d("span",ue,[d("span",null,[K(F(k.label)+" ",1),o.showNodeKey?(y(),m("span",pe,"("+F(A[o.nodeKey])+")",1)):b("",!0)]),d("span",{class:"space-x-4",onClick:e[4]||(e[4]=le(()=>{},["stop"]))},[A[o.uprNodeKey]?(y(),se(l,{key:0,link:"",class:"!p-0",onClick:ee=>P(A)},{default:u(()=>[G(t.$slots,"removeBtn",{},()=>[e[11]||(e[11]=K(" 삭제 "))],!0)]),_:2},1032,["onClick"])):b("",!0),a(l,{link:"",class:"!p-0",onClick:ee=>j(A)},{default:u(()=>[G(t.$slots,"addBtn",{},()=>[e[12]||(e[12]=K(" 추가 "))],!0)]),_:2},1032,["onClick"])])])]),_:3},8,["props","node-key","data","draggable"])])]),a(Z,{title:`${p.value} 삭제`,ref_key:"delConfirmRef",ref:h,confirm:"",onConfirm:e[5]||(e[5]=k=>O(R.value))},{default:u(()=>[p.value==N.CODE?(y(),m("p",fe," 선택된 코드를 정말 삭제하시겠습니까? ")):p.value==N.CATEGORY?(y(),m("p",ye," 선택된 카테고리 및 하위 코드까지 함께 삭제됩니다. 정말 삭제하시겠습니까? ")):b("",!0)]),_:1},8,["title"])],64)}}},me=te(ve,[["__scopeId","data-v-2b35002b"]]),ge={class:"section-area"},_e={class:"article-area",style:{height:"100%"}},he={style:{display:"flex","column-gap":"1rem",width:"100%",height:"100%"}},ke={class:"",style:{height:"100%"}},Ne={style:{width:"100%"}},Ce={key:0},be={__name:"CodeMngPage",setup(U){const T=S("axios");S("config"),S("msg");const $=i(null),B=i(null);i(null);const x=i([]),_=i([]),o=i(!0);i("first"),i(""),i([]),i(null),de(()=>{T.get("code").then(p=>{x.value.push(p.data[0]||{cdId:null,cdNm:"초기값"}),$.value.initNodeKeys()}).finally(()=>{o.value=!1})});const N=p=>_.value=p,R=()=>{const c=Array.from(B.value.querySelectorAll("input")).find(h=>!h.disabled);c&&c.focus()};return(p,c)=>{const h=v("el-card"),g=v("el-input");return y(),m("section",ge,[c[1]||(c[1]=d("article",{class:"article-area"},[d("p",{class:"section-title"}," 코드 관리 "),d("div",{style:{height:"5px",background:"black",width:"50px",margin:".5em auto 2.5rem auto"}})],-1)),d("article",_e,[d("div",he,[d("div",ke,[a(h,{style:{width:"400px",height:"100%"}},{default:u(()=>[a(me,{data:x.value,"save-url":"/code",filter:"","show-node-key":"","node-key":"cdId","upr-node-key":"uprCdId","code-type":"CD","tree-props":{label:"cdNm",value:"cdId"},draggable:"",onNodeSelect:N,onKeyupEnter:R,ref_key:"treeRef",ref:$},null,8,["data"])]),_:1})]),d("div",Ne,[a(h,{class:"h-full"},{default:u(()=>[o.value?b("",!0):(y(),m("div",{key:0,ref_key:"formRef",ref:B},[c[0]||(c[0]=d("p",{class:"text-xl"},"코드 상세보기",-1)),(y(!0),m(Y,null,ae(Object.keys(x.value[0]),(f,j)=>(y(),m("div",{key:f},[f!="children"?(y(),m("div",Ce,[d("p",null,F(f),1),a(g,{modelValue:_.value[f],"onUpdate:modelValue":P=>_.value[f]=P,disabled:["cdId","uprCdId"].includes(f)},null,8,["modelValue","onUpdate:modelValue","disabled"])])):b("",!0)]))),128))],512))]),_:1})])])])])}}};export{be as default};
